<html>

<head>
<script src = "/socket.io/socket.io.js"></script>

</head>

<body style="margin:0">


<div class="main">
<canvas id="canvas" style="width:100%;height:100%">
</canvas>
</div>

<div id="debug" style="margin-top:-200;width:100%height:10%;border:1px solid black;text-align:center"></div>



	var socket = io();
	var canvas = document.getElementById("canvas");
	var debug = document.getElementById("debug");
	var ctx = canvas.getContext("2d");
	canvas.width = window.innerWidth;
	canvas.height = window.innerHeight;
	var input = {
		keys:[],
		mouseX:0,
		mouseY:0
	}
	var itr = 0;
	window.addEventListener('keydown', function (e) {
        input.keys[e.keyCode] = true;
		socket.emit('input',input);
    });
    window.addEventListener('keyup', function (e) {
        input.keys[e.keyCode] = false; 
		socket.emit('input',input);
    });
	window.addEventListener('mousemove', function(e){
		itr++;
		input.mouseX = e.pageX ;
		input.mouseY = e.pageY ;
		
		if(itr%3==0){
			socket.emit('input',input);
			itr=0;
		}
	});
	socket.on('update',function(data){
		canvas.width = window.innerWidth;
		canvas.height = window.innerHeight;
		ctx.clearRect(0,0,canvas.width,canvas.height);
		for(i in data){
			//ctx.fillRect(data[i].posX,data[i].posY,30,30);
			ctx.save();
			ctx.translate(data[i].posX+15,data[i].posY+15);
			ctx.rotate(data[i].angle);
			ctx.translate(-(data[i].posX+15),-(data[i].posY+15));
			ctx.fillRect(data[i].posX,data[i].posY,30,30);
			ctx.restore();
			debug.innerHTML = data[i].ownX+ " "+data[i].ownY+ " "+data[i].angle;
		}
		//ctx.fillStyle = "green";
		//ctx.fillRect(data.posX,data.posY,10,10);
	});



</body>
</html>
